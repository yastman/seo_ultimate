# ТЗ: Аудит распределения ключей по иерархии

**Дата:** 2026-01-05
**Этап:** 2.1 (дополнение к Этапу 2)
**Статус:** ⬜ К выполнению
**Приоритет:** Высокий (блокирует Этап 3-4)

---

## Проблема

При аудите Этапа 2 проверяли только "мусорные" ключи между разными категориями.

**Не проверяли:** корректность распределения внутри иерархии L1 → L2 → L3.

**Пример:**
```
L1: Мойка и Экстерьер
├── Direct Keywords (L1) — "автохимия", "химия для мойки"
├── L2: Автошампуни
│   ├── Direct Keywords (L2) — "шампунь для авто"
│   ├── L3: Активная пена — "активная пена для мойки"
│   └── L3: Шампуни для ручной мойки — "шампунь для ручной мойки"
```

Если ключ `шампунь для авто` попал в L3: Активная пена — это ошибка. Он общий для L2.

---

## Цель

Проверить ВСЕ уровни иерархии:
- L3 ключи → не должны быть общими для L2
- L2 ключи → не должны быть общими для L1
- L1 ключи → не должны быть общими для всего сайта

---

## Правило

**Ключ принадлежит уровню N**, если содержит специфику этого уровня.

**Ключ поднимается на уровень выше**, если он общий (без специфики).

| Ключ | Специфика | Уровень |
|------|-----------|---------|
| `активная пена для мойки` | "активная пена" | L3: Активная пена ✅ |
| `шампунь для авто` | нет специфики L3 | L2: Автошампуни ✅ |
| `химия для мойки` | нет специфики L2 | L1: Мойка и Экстерьер ✅ |
| `средство для кожи авто` | нет специфики L3 | L2: Средства для кожи ✅ |
| `уход за кожей авто` | "уход" | L3: Уход за кожей ✅ |

---

## Чеклист для аудита

### Уровень L1 (Direct Keywords)

Проверить: нет ли ключей, которые слишком общие и не относятся к конкретному L1?

| L1 | Direct Keywords | Проверить |
|----|-----------------|-----------|
| Мойка и Экстерьер | (1920 vol) | [ ] |
| Аксессуары | (220 vol) | [ ] |
| Полировка | — | [ ] |
| Уход за интерьером | — | [ ] |
| Защитные покрытия | (110 vol) | [ ] |

---

### Уровень L2 (Direct Keywords внутри L2)

Проверить: нет ли ключей, которые должны быть в L1 (слишком общие)?

| L1 | L2 | Проверить |
|----|-----|-----------|
| Мойка и Экстерьер | Автошампуни | [ ] |
| Мойка и Экстерьер | Средства для стекол | [ ] |
| Мойка и Экстерьер | Очистители кузова | [ ] |
| Мойка и Экстерьер | Средства для дисков и шин | [ ] |
| Мойка и Экстерьер | Очистители двигателя | [ ] |
| Аксессуары | Малярний Скотч | [ ] |
| Аксессуары | Микрофибра и тряпки | [ ] |
| Аксессуары | Щетки и кисти | [ ] |
| Аксессуары | Губки и варежки | [ ] |
| Аксессуары | Распылители и пенники | [ ] |
| Аксессуары | Аксессуары для нанесения | [ ] |
| Аксессуары | Ведра и емкости | [ ] |
| Аксессуары | Наборы | [ ] |
| Полировка | Полировальные машинки | [ ] |
| Полировка | Полировальные пасты | [ ] |
| Полировка | Полировальные круги | [ ] |
| Уход за интерьером | Нейтрализаторы запаха | [ ] |
| Уход за интерьером | Полироли для пластика | [ ] |
| Уход за интерьером | Средства для кожи | [ ] |
| Уход за интерьером | Для химчистки салона | [ ] |
| Защитные покрытия | Воски | [ ] |
| Защитные покрытия | Керамика и жидкое стекло | [ ] |
| Защитные покрытия | Квик-детейлеры | [ ] |
| Защитные покрытия | Оборудование | [ ] |
| Защитные покрытия | Очистители салона | [ ] |

---

### Уровень L3 (внутри L2)

Проверить: нет ли ключей, которые должны быть в L2 Direct Keywords (слишком общие)?

#### L1: Мойка и Экстерьер

| L2 | L3 | Проверить |
|----|-----|-----------|
| Автошампуни | Шампуни для ручной мойки | [ ] |
| Автошампуни | Активная пена | [ ] |
| Средства для стекол | Омыватель | [ ] |
| Средства для стекол | Антидождь | [ ] |
| Средства для стекол | Очистители стекол | [ ] |
| Очистители кузова | Глина и автоскрабы | [ ] |
| Очистители кузова | Антимошка | [ ] |
| Очистители кузова | Антибитум | [ ] |
| Очистители кузова | Чернители наружного пластика | [ ] |
| Средства для дисков и шин | Чернители шин | [ ] |
| Средства для дисков и шин | Очистители дисков | [ ] |
| Средства для дисков и шин | Очистители шин | [ ] |
| Средства для дисков и шин | Керамика для дисков | [ ] |

#### L1: Аксессуары

| L2 | L3/Cluster | Проверить |
|----|------------|-----------|
| Микрофибра и тряпки | Тряпка для авто | [ ] |
| Микрофибра и тряпки | Тряпка для вытирания | [ ] |
| Щетки и кисти | Щетка для мойки авто | [ ] |
| Щетки и кисти | Кисти для детейлинга | [ ] |
| Наборы | Наборы для мойки | [ ] |
| Наборы | Наборы для салона | [ ] |

#### L1: Полировка

| L2 | L3 | Проверить |
|----|-----|-----------|
| Полировальные круги | Меховые | [ ] |
| Полировальные круги | General (наборы) | [ ] |

#### L1: Уход за интерьером

| L2 | L3 | Проверить |
|----|-----|-----------|
| **Средства для кожи** | **Уход за кожей** | [ ] ← ИЗВЕСТНАЯ ПРОБЛЕМА |
| **Средства для кожи** | **Очистители кожи** | [ ] |
| Для химчистки салона | Пятновыводители | [ ] |

#### L1: Защитные покрытия

| L2 | L3 | Проверить |
|----|-----|-----------|
| Воски | Твердый воск | [ ] |
| Воски | Жидкий воск | [ ] |
| Квик-детейлеры | Силанты | [ ] |
| Оборудование | Аппараты Tornador | [ ] |

---

## Известные проблемы

| Ключ | Сейчас | Должен быть | Volume |
|------|--------|-------------|--------|
| средство для кожи авто | L3: Уход за кожей | L2: Средства для кожи (Direct) | 110 |
| средства для кожи автомобиля | L3: Уход за кожей | L2: Средства для кожи (Direct) | 90 |

**TODO:** Найти все подобные случаи при аудите.

---

## Формат отчёта

После аудита создать список миграций:

```markdown
## Миграции L2 ↔ L3

| Ключ | Volume | Откуда | Куда |
|------|--------|--------|------|
| средство для кожи авто | 110 | L3: Уход за кожей | L2: Средства для кожи |
| ... | ... | ... | ... |
```

---

## Выполнение

1. [ ] Пройти по чеклисту выше
2. [ ] Для каждого L3 проверить: есть ли общие ключи?
3. [ ] Выписать все найденные проблемы в отчёт
4. [ ] Вручную перенести ключи в CSV
5. [ ] Вручную обновить STRUCTURE.md

---

## Критерии приёмки

1. ✅ Все L3 кластеры проверены вручную
2. ✅ Общие ключи перенесены в L2 Direct Keywords
3. ✅ CSV обновлён вручную
4. ✅ STRUCTURE.md обновлён вручную

---

## После выполнения

1. Обновить ROADMAP — Этап 2.1 ✅
2. Перенести ТЗ в `completed/`
3. Продолжить с Этапом 3 (Маппинг структуры)
