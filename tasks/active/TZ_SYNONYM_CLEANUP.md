# ТЗ: Чистка синонимов (Batch)

**Дата:** 2026-01-05
**Этап:** 4
**Статус:** ⬜ К выполнению
**Оценка:** ~4 часа
**Зависимость:** `data/catalog_structure.json` (Этап 3) + распределение кластеров → страниц (см. `tasks/reports/CLUSTER_DISTRIBUTION.md`)

---

## Цель

Создать `_clean.json` для каждой категории с типом `category` из маппинга.

**Результат:** Дедуплицированные ключи, готовые для генерации контента.

---

## Эталон

**Файл:** `categories/aktivnaya-pena/data/aktivnaya-pena_clean.json`

| Метрика | До | После |
|---------|-----|-------|
| Ключей | 52 | 12 |
| Сокращение | — | -77% |

**Структура:**
```json
{
  "slug": "aktivnaya-pena",
  "language": "ru",
  "keywords": {
    "primary": [
      { "keyword": "пена для мойки авто", "volume": 1300, "cluster": "main" }
    ],
    "secondary": [
      { "keyword": "активная пена для бесконтактной мойки", "volume": 320, "cluster": "method" }
    ],
    "supporting": [
      { "keyword": "пена для минимойки", "volume": 70, "cluster": "equipment" }
    ],
    "commercial": [
      { "keyword": "купить пену для мойки авто", "volume": 590, "use_in": "meta_only" }
    ]
  },
  "usage_rules": {
    "primary": "H1 + intro",
    "secondary": "H2",
    "supporting": "FAQ, контекст",
    "commercial": "ТОЛЬКО meta title/description"
  },
  "stats": {
    "before": 52,
    "after": 12
  }
}
```

---

## Правила дедупликации

### 1. Синонимы объектов

| Оставить | Удалить |
|----------|---------|
| `авто` | `автомобиля`, `машины` |
| `мойки` | `мытья` |
| `для авто` | `для автомобиля`, `для машины` |

**Пример:**
- `пена для мойки авто` (1300) ← ОСТАВИТЬ
- `пена для мойки автомобиля` (1300) ← удалить
- `пена для мытья машины` (90) ← удалить

### 2. Коммерческие хвосты

| Паттерн | Действие |
|---------|----------|
| `купить X` | Объединить в один |
| `X купить` | ↳ оставить `купить X` |
| `X цена` | ↳ |
| `X заказать` | ↳ |

**Пример:**
- `купить пену для мойки авто` (590) ← ОСТАВИТЬ
- `пена для мойки авто купить` (10) ← удалить
- `активная пена цена` (10) ← удалить

### 3. Вариации порядка слов

| Оставить | Удалить |
|----------|---------|
| Более частотный | Менее частотный |

**Пример:**
- `активная пена` (720) ← ОСТАВИТЬ
- `пена активная` (50) ← удалить

### 4. Что НЕ объединять

- Разные продукты: `шампунь для мойки` ≠ `шампунь для химчистки`
- Разные методы: `бесконтактная мойка` ≠ `ручная мойка`
- Разное оборудование: `для минимойки` ≠ `для автомойки`

---

## Метод: Ручной

### Шаг 1: Открыть RAW файл

Открыть `categories/{slug}/data/{slug}.json` — все ключи из CSV.

### Шаг 2: Ручная чистка

1. Найти группы синонимов (авто/автомобиля/машины)
2. Оставить самый частотный вариант
3. Распределить по типам:
   - `primary` — ВЧ ключи для H1, intro
   - `secondary` — СЧ для H2
   - `supporting` — НЧ для FAQ, контекста
   - `commercial` — купить/цена (meta_only)

### Шаг 3: Создать `_clean.json`

Создать файл `categories/{slug}/data/{slug}_clean.json` по эталону `aktivnaya-pena`.

---

## Чеклист выполнения

### Подготовка

- [x] Этап 3 завершён (`data/catalog_structure.json` готов)
- [ ] Изучен эталон `aktivnaya-pena_clean.json`

### Ручная обработка каждой категории

Для каждой категории с `type: category`:

- [ ] Открыть `{slug}.json`
- [ ] Выписать группы синонимов
- [ ] Выбрать представителя (max volume)
- [ ] Распределить: primary / secondary / supporting / commercial
- [ ] Создать `{slug}_clean.json`
- [ ] Заполнить `stats.before` и `stats.after`

### Валидация

- [ ] Все категории имеют `_clean.json`
- [ ] Формат соответствует эталону
- [ ] commercial помечены `use_in: meta_only`

---

## Приоритет категорий

Начать с высокочастотных (больше трафика):

| # | Категория | Volume | Ключей |
|---|-----------|--------|--------|
| 1 | aktivnaya-pena | 9100 | 52 → ✅ готово |
| 2 | cherniteli-shin | ~5000 | ? |
| 3 | ochistiteli-diskov | ~4000 | ? |
| 4 | avtoshampuni | ~3500 | ? |
| 5 | ... | ... | ... |

---

## Критерии приёмки

1. ✅ Все категории `type: category` имеют `_clean.json`
2. ✅ Формат соответствует эталону
3. ✅ Сокращение ключей: в среднем -50% или более
4. ✅ Разделение по типам: primary/secondary/supporting/commercial
5. ✅ commercial ключи помечены `use_in: meta_only`

---

## После выполнения

1. Обновить `tasks/PIPELINE_STATUS.md` — Этап 4 ✅
2. Перенести это ТЗ в `tasks/completed/`
3. Перейти к Этапу 5 (Генерация контента)

---

## Примечания

- НЕ редактировать текст ключей, только выбирать какой оставить
- При сомнениях — оставить оба (лучше больше, чем потерять)
- commercial ключи НИКОГДА не использовать в тексте статьи
- Эталон `aktivnaya-pena` — главный ориентир
