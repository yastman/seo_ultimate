# Content-Reviewer v2.0 — Design Plan

**Date:** 2026-01-22
**Status:** Draft
**Goal:** Обновить content-reviewer для полноценной ревизии и переписывания контента как buyer guide с коммерческим интентом.

---

## Problem Statement

**Текущий content-reviewer:**
- ✅ Проверяет технические метрики (density, water, keywords count)
- ✅ Делает базовую qualitative проверку (6 критериев)
- ❌ НЕ распознаёт "сухой" текст (справочник vs buyer guide)
- ❌ НЕ умеет переписывать по образцу хороших текстов
- ❌ НЕ проверяет полноту относительно RESEARCH_DATA.md
- ❌ НЕ гарантирует распределение ВСЕХ ключей

**Результат:** После ревизии текст технически валиден, но остаётся "сухим справочником" без коммерческого интента.

---

## Solution Overview

Добавить 4 новых capability:

| # | Capability | Что делает | Trigger |
|---|------------|------------|---------|
| 1 | **Commercial Intent Check** | Проверяет что каждая секция про ВЫБОР | Всегда |
| 2 | **Dryness Diagnosis** | Определяет: buyer guide или справочник? | Всегда |
| 3 | **Keywords Distribution** | Гарантирует 100% ключей в тексте | Всегда |
| 4 | **Research Completeness** | Проверяет все типы/факты из research | Всегда |
| 5 | **Reference-based Rewrite** | Переписывает по образцу | Если REWRITE NEEDED |

---

## Central Principle: Commercial Intent

**Главный вопрос текста:** "Какой товар мне купить?"

**Тест каждой секции:**
> "Эта секция помогает ВЫБРАТЬ товар или УЧИТ его использовать?"

| Ответ | Действие |
|-------|----------|
| Помогает выбрать | ✅ Оставить |
| Учит использовать | ❌ Удалить или переделать |

### Коммерческий vs Информационный интент

| ✅ Коммерческий (оставлять) | ❌ Информационный (удалять) |
|----------------------------|----------------------------|
| "Если нужен X → выбирай Y" | "Как работает X" |
| Таблица "Тип → Когда брать" | Пошаговая инструкция 5+ шагов |
| "На что смотреть на этикетке" | "История создания" |
| Сценарии: новичок/профи/бюджет | Теория и принципы |
| FAQ про выбор | FAQ про процессы |
| "Чего избегать при выборе" | "Ошибки при нанесении" |
| "Что влияет на результат" | "Как правильно наносить" |

### How-to STOP-LIST

**BLOCKER:** Эти H2/H3 = информационный интент. Удалить или переделать!

| ❌ Запрещено | ✅ Альтернатива |
|--------------|-----------------|
| "Как наносить {X}" | Убрать или "Что учесть при выборе" |
| "Профессиональный подход к нанесению" | "Что влияет на результат" |
| "Техника применения" | Убрать секцию |
| "Подготовка поверхности" | 1 фраза в intro максимум |
| "Ошибки при нанесении" | "Чего избегать при выборе" |
| "Пошаговая инструкция" | Удалить полностью |

---

## Capability 1: Dryness Diagnosis

**Признаки "сухого" текста (справочника):**

| # | Признак | Как проверить | Weight |
|---|---------|---------------|--------|
| 1 | Intro = определение | Начинается с "X — это Y, которое..." | 2 |
| 2 | Нет обращений к читателю | Отсутствуют "вам", "если вы", "выбирайте" | 1 |
| 3 | <3 паттернов "Если X → Y" | Подсчёт сценариев выбора | 1 |
| 4 | Таблицы без "Когда брать" | Колонки характеристик, не сценариев | 1 |
| 5 | FAQ про процесс, не выбор | "Как наносить?" вместо "Какой выбрать?" | 2 |
| 6 | Academic <7% | check_water_natasha.py | 1 |
| 7 | Нет секции "Сценарии покупки" | Отсутствует явный блок сценариев | 1 |

**Verdict по сумме весов:**
- 0-2 → ✅ TEXT OK
- 3-4 → ⚠️ MINOR FIXES
- 5+ → ❌ REWRITE NEEDED

---

## Capability 2: Keywords Distribution

**Источник:** `categories/{path}/meta/{slug}_meta.json` → `keywords_in_content`

### Требования покрытия

| Группа | Требование | Severity |
|--------|------------|----------|
| primary | **100%** — все должны быть в тексте | BLOCKER |
| secondary | **100%** — все должны быть | BLOCKER |
| supporting | **≥80%** — большинство | WARNING |

### Куда распределять ключи

| Место в тексте | Какие ключи | Приоритет |
|----------------|-------------|-----------|
| Intro (1-2 абзац) | primary + 1-2 secondary | HIGH |
| H2 заголовки | secondary (минимум 1 H2) | HIGH |
| Сценарии покупки | supporting | MEDIUM |
| Таблицы (ячейки) | supporting | MEDIUM |
| FAQ вопросы/ответы | secondary | MEDIUM |
| Секция "Итог" | primary | LOW |

### Антипаттерн — keyword stuffing

```markdown
❌ ПЛОХО (все ключи в одном абзаце):
"Пена для мойки авто и пена для мойки автомобиля — это активная пена
для мойки авто, также известная как шампунь для бесконтактной мойки..."

✅ ХОРОШО (распределены по секциям):
- Intro: "Пена для мойки автомобиля размягчает грязь — безопасная мойка..."
- H2: "Как выбрать активную пену для мойки авто"
- Сценарий: "пена для минимойки с повышенной липкостью"
- FAQ: "Чем шампунь для бесконтактной мойки отличается..."
```

### Workflow добавления ключей

```
1. Выписать ВСЕ ключи из _meta.json → keywords_in_content
2. Для каждого — выделить стем (основу): "средство от битума" → "средств" + "битум"
3. Grep в контенте — найдено/нет (любое склонение OK)
4. Если не найдено:
   a. Найти подходящее место по приоритету (см. таблицу выше)
   b. Вставить органично (не спамить!)
   c. Проверить что density стема <3%
5. После всех вставок — re-run check_keyword_density.py
```

---

## Capability 3: Research Completeness

**Источник истины:** `categories/{path}/research/RESEARCH_DATA.md`

### Что проверять

| Блок Research | Что проверять | Severity |
|---------------|---------------|----------|
| Блок 2: Виды и типы | Все типы товаров упомянуты в тексте? | BLOCKER |
| Блок 1: Что это | Ключевые факты использованы? | WARNING |
| Блок 3: Как выбрать | Сценарии выбора отражены? | WARNING |
| Блок 5: Ошибки | Важные предупреждения есть? | WARNING |
| Блок 6а: Спорные | НЕ использованы без подтверждения? | BLOCKER |
| Блок 10: Цифры | Только подтверждённые данные? | INFO |

### Пример проверки (aktivnaya-pena)

```
RESEARCH_DATA.md Блок 2:
- Щелочная (pH 10-12)
- Нейтральная (pH 7-9)
- Кислотная (pH 2-4)
- С воском (Wash & Wax)

Контент содержит:
✅ Щелочная — есть
✅ Нейтральная — есть
✅ Кислотная — есть
✅ С воском — есть

→ Research Completeness: PASS
```

### Checklist

- [ ] Все типы из Блок 2 упомянуты в таблице или сценариях
- [ ] Нет противоречий с фактами из research
- [ ] Спорные утверждения (Блок 6а) НЕ использованы
- [ ] Цифры только из Блок 10 (с источниками)

---

## Capability 4: Reference-based Rewrite

**Когда активируется:** Verdict = REWRITE NEEDED

### Референсные тексты (читать перед переписыванием)

```
categories/moyka-i-eksterer/avtoshampuni/aktivnaya-pena/content/aktivnaya-pena_ru.md
categories/moyka-i-eksterer/ochistiteli-kuzova/antibitum/content/antibitum_ru.md
categories/moyka-i-eksterer/sredstva-dlya-diskov-i-shin/cherniteli-shin/content/cherniteli-shin_ru.md
```

### Паттерны из референсов

| Элемент | Паттерн | Пример |
|---------|---------|--------|
| **Intro** | польза + "если X → Y" сценарий | "Пена размягчает грязь... Если у вас керамика — выбирайте pH-нейтральную" |
| **Таблица типов** | колонка "Когда брать" | "Зимняя грязь, реагенты, первая мойка" |
| **Сценарии покупки** | **Жирное условие** → решение | "**Авто с керамикой** → нейтральный состав сохранит гидрофобный слой" |
| **На этикетке** | Маркер → Что означает → Рекомендация | 3-колоночная таблица |
| **Что влияет** | Фактор → Влияние (НЕ how-to!) | "Давление АВД → Ниже 100 бар → жидкая консистенция" |
| **Чего избегать** | Антипаттерн покупки + почему | "Щелочная для еженедельной мойки — воск смоется" |
| **FAQ** | Вопрос про ВЫБОР | "Какой продукт выбрать для авто с керамикой?" |
| **Итог** | "что вам покупать" + → сценарии | "Регулярная мойка → нейтральный концентрат" |

### Структура buyer guide (шаблон)

```markdown
# {H1 из meta}

{Intro: польза + "если X → Y" + обращение к читателю}

## Как выбрать {категорию}

| Тип | {Ключевой параметр} | Когда брать |
|-----|---------------------|-------------|

**Сценарии покупки:**
- **{Условие 1}** → {решение + почему}
- **{Условие 2}** → {решение + почему}
- **{Условие 3}** → {решение + почему}

## На что смотреть на этикетке

| Маркер | Что означает | Рекомендация |
|--------|--------------|--------------|

{Профтермин 1} — {объяснение для выбора}.
{Профтермин 2} — {объяснение для выбора}.

## Что влияет на результат

| Фактор | Влияние |
|--------|---------|

## Чего избегать при выборе

**{Антипаттерн 1}** — {почему плохо для покупателя}.
**{Антипаттерн 2}** — {почему плохо для покупателя}.

## FAQ

### {Вопрос про выбор 1}?
{Ответ 2-3 предложения}

### {Вопрос про выбор 2}?
{Ответ 2-3 предложения}

---

**Итог — что вам покупать:**

- **{Сценарий 1}** → {рекомендация}
- **{Сценарий 2}** → {рекомендация}
- **{Сценарий 3}** → {рекомендация}
```

---

## Updated Workflow

```
┌─────────────────────────────────────────────────────────────┐
│ Step 1: Read files (parallel)                               │
│   - _clean.json (name, parent_id)                           │
│   - _meta.json (h1, keywords_in_content)                    │
│   - RESEARCH_DATA.md (источник истины)                      │
│   - {slug}_ru.md (контент для ревизии)                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 2: Run validators (parallel)                           │
│   - validate_meta.py                                        │
│   - validate_content.py --mode seo                          │
│   - check_keyword_density.py                                │
│   - check_water_natasha.py                                  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 3: Keywords Coverage                                   │
│   - Выписать ключи из _meta.json                            │
│   - Проверить каждый в контенте (стем-поиск)                │
│   - Verdict: primary 3/3, secondary 3/3, supporting 4/4     │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 4: Research Completeness                               │
│   - Все типы из Блок 2 в тексте?                            │
│   - Нет противоречий с фактами?                             │
│   - Спорные (Блок 6а) НЕ использованы?                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 5: Commercial Intent Check                             │
│   - Каждая секция про ВЫБОР, не про использование?          │
│   - Нет how-to секций из STOP-LIST?                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 6: Dryness Diagnosis                                   │
│   - Подсчёт признаков "сухости" (7 критериев)               │
│   - Verdict: TEXT OK / MINOR FIXES / REWRITE NEEDED         │
└─────────────────────────────────────────────────────────────┘
                              ↓
                    ┌─────────────────┐
                    │ REWRITE NEEDED? │
                    └────────┬────────┘
                   YES       │        NO
                    ↓        │         ↓
┌───────────────────────┐    │    ┌───────────────────────┐
│ Step 7a: Read refs    │    │    │ Step 7b: Fix issues   │
│ - aktivnaya-pena      │    │    │ - Add missing keys    │
│ - antibitum           │    │    │ - Fix BLOCKERs        │
│ - cherniteli-shin     │    │    │ - Fix WARNINGs        │
│                       │    │    │                       │
│ Step 7a: Rewrite      │    │    │                       │
│ - По паттернам        │    │    │                       │
│ - По шаблону          │    │    │                       │
│ - Все ключи           │    │    │                       │
│ - Все типы из research│    │    │                       │
└───────────────────────┘    │    └───────────────────────┘
                    ↓        │         ↓
                    └────────┴─────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 8: Re-validate                                         │
│   - Все 4 валидатора повторно                               │
│   - Keywords coverage повторно                              │
│   - Research completeness повторно                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 9: Output Verdict                                      │
│   - ✅ PASS: контент валиден                                │
│   - ⚠️ WARNING: мелкие замечания                            │
│   - ❌ FIXED: исправлено/переписано                         │
└─────────────────────────────────────────────────────────────┘
```

---

## Verdict Table (updated)

| Критерий | Результат | Примечание |
|----------|-----------|------------|
| Meta | ✅/❌ | validate_meta.py |
| Density | ✅/⚠️/❌ | stem max X% |
| Тошнота | ✅/⚠️/❌ | classic X |
| Вода | ✅/⚠️ | X% |
| Academic | ✅/⚠️ | X% (≥7% required) |
| H1=name | ✅/❌ | |
| **Keywords** | ✅/⚠️/❌ | primary X/X, secondary X/X, supporting X/X |
| **Research Types** | ✅/❌ | все типы из Блок 2 |
| **Research Facts** | ✅/⚠️ | ключевые факты |
| **Commercial Intent** | ✅/❌ | все секции про выбор |
| **Dryness** | ✅/⚠️/❌ | TEXT OK / MINOR / REWRITE |
| Intro | ✅/❌ | buyer guide / определение |
| Обращения | ✅/⚠️ | есть / нет |
| Паттерны | ✅/⚠️ | X шт (≥3) |
| Сценарии покупки | ✅/❌ | есть секция |
| FAQ | ✅/❌ | про выбор / про процесс |
| **VERDICT** | **✅/⚠️/❌** | |

---

## Files to Update

| File | Action | Priority |
|------|--------|----------|
| `.claude/agents/content-reviewer.md` | Major update | P1 |
| `.claude/skills/content-reviewer/SKILL.md` | Major update | P1 |
| `.claude/agents/uk-content-reviewer.md` | Sync changes | P2 |

---

## Implementation Tasks

### Task 1: Update content-reviewer agent

**File:** `.claude/agents/content-reviewer.md`

**Changes:**
1. Add Commercial Intent section with STOP-LIST
2. Add Dryness Diagnosis with 7 criteria
3. Update Keywords Coverage to require 100%
4. Add Research Completeness checks
5. Add Reference-based Rewrite workflow
6. Add reference texts paths
7. Update verdict table
8. Update workflow diagram

### Task 2: Update content-reviewer skill

**File:** `.claude/skills/content-reviewer/SKILL.md`

**Changes:**
- Mirror all changes from agent
- Keep skill format (shorter, links to this plan)

### Task 3: Sync UK reviewer

**File:** `.claude/agents/uk-content-reviewer.md`

**Changes:**
- Apply same logic with UK terminology
- UK reference texts (when available)

### Task 4: Test on category

**Test:** Run updated reviewer on `antimoshka` or `obezzhirivateli`
- Verify dryness detection works
- Verify rewrite triggers correctly
- Verify keywords distribution

---

## Success Criteria

После обновления content-reviewer должен:

1. ✅ Распознавать "сухой" текст и требовать REWRITE
2. ✅ Гарантировать 100% ключей primary/secondary в тексте
3. ✅ Проверять что все типы товаров из RESEARCH_DATA.md упомянуты
4. ✅ Отсекать how-to секции (информационный интент)
5. ✅ Переписывать по образцу референсных текстов
6. ✅ Выдавать финальный текст как живой buyer guide

---

## Reference Documents

- `.claude/skills/content-generator/skill.md` — паттерны buyer guide
- `.claude/skills/content-generator/references/buyer-guide.md` — детальные правила
- `.claude/skills/content-generator/references/templates.md` — шаблоны по типам
- `.claude/skills/content-generator/references/research-mapping.md` — трансформация research → content
- `docs/plans/2026-01-21-content-revision-plan-v4.md` — план ревизии 50 категорий

---

**Plan Version:** 1.0 | **Created:** 2026-01-22
