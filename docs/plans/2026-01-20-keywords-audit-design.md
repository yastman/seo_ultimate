# Дизайн: Аудит распределения ключей в _clean.json

**Дата:** 2026-01-20
**Статус:** Черновик

---

## Цель

Проверить все 49 файлов `_clean.json` на правильность распределения ключей перед массовым написанием текстов.

---

## Проблема

Текущая структура многих `_clean.json` содержит в `keywords` несколько ключей с **разными корнями**:

```json
"keywords": [
  { "keyword": "химия для мойки авто", "volume": 260 },
  { "keyword": "средство для мойки авто", "volume": 70 },
  { "keyword": "автохимия для мойки", "volume": 50 }
]
```

Это приводит к:
- Спаму в Title (все ключи пытаются попасть туда)
- Непониманию что вписывать в текст
- Дублированию по интенту

---

## Правильная логика

### Определение "корня"

**Корень** — уникальное смысловое слово, которое Google НЕ считает синонимом другого.

| Слово A | Слово B | Это один корень? |
|---------|---------|------------------|
| химия | автохимия | ❌ Разные (авто- = префикс) |
| химия | средство | ❌ Разные |
| авто | машина | ✅ Один (Google синонимизирует) |
| авто | автомобиль | ✅ Один |
| шампунь | пена | ❌ Разные |
| воск | полимер | ❌ Разные |

### Правильная структура _clean.json

```json
{
  "keywords": [
    { "keyword": "химия для мойки авто", "volume": 260 }  // Только Король (max volume)
  ],
  "synonyms": [
    // Другие корни (обязательно вписать в текст по 1 разу)
    { "keyword": "средство для мойки авто", "volume": 70 },
    { "keyword": "автохимия для мойки", "volume": 50 },

    // Вариации главного корня (для отката, не вписывать)
    { "keyword": "химия для мойки машины", "volume": 50 },
    { "keyword": "химия для мойки автомобиля", "volume": 20 }
  ],
  "commercial": [
    { "keyword": "купить химию для мойки авто", "volume": 260, "use_in": "meta_only" }
  ]
}
```

### Использование в контенте

| Элемент | Источник | Правило |
|---------|----------|---------|
| Title | keywords[0] | Только Король |
| H1 | keywords[0] | Только Король (без "купить") |
| Текст | Все уникальные корни | Каждый корень минимум 1 раз |
| Description | keywords[0] + commercial | Король + коммерческий модификатор |

---

## Критерии аудита

Для каждого `_clean.json`:

1. **Прочитать `keywords`**
2. **Извлечь корни** из каждого ключа
3. **Определить статус:**
   - ✅ OK — только 1 уникальный корень в keywords
   - ⚠️ REVIEW — 2+ уникальных корня в keywords (нужна ручная проверка)
   - ❌ ERROR — нет keywords или пустой массив

---

## Формат отчёта

```markdown
## Группа: aksessuary

| Категория | Keywords | Корни | Статус |
|-----------|----------|-------|--------|
| aksessuary | аксессуары для авто (50) | аксессуары | ✅ OK |
| gubki-i-varezhki | губка для мойки (80), варежка (60) | губка, варежка | ⚠️ REVIEW |

### ⚠️ Требуют проверки:
1. **gubki-i-varezhki** — 2 корня: губка, варежка
   - Рекомендация: оставить "губка" в keywords, "варежка" в synonyms
```

---

## План выполнения

### Группы (5 агентов параллельно)

| Группа | Файлы | Количество |
|--------|-------|------------|
| 1 | aksessuary/* | 10 |
| 2 | moyka-i-eksterer (часть 1) | 10 |
| 3 | moyka-i-eksterer (часть 2) | 10 |
| 4 | polirovka + ukhod-za-intererom | 10 |
| 5 | zashchitnye-pokrytiya + oborudovanie + opt-i-b2b | 9 |

### Задача каждого агента

```
1. Прочитать _clean.json файлы своей группы
2. Для каждого файла:
   a. Извлечь keywords
   b. Определить уникальные корни
   c. Присвоить статус (✅/⚠️/❌)
3. Вернуть отчёт в формате markdown-таблицы
```

---

## Следующие шаги после аудита

1. **Собрать отчёты** от 5 агентов
2. **Список ⚠️ REVIEW** — категории для ручной проверки
3. **Исправить** проблемные _clean.json (перенести лишние корни в synonyms)
4. **Запустить массовую генерацию контента**

---

## Зависимости

- 49 файлов `categories/**/data/*_clean.json`
- Логика определения корней (см. таблицу выше)

---

**Version:** 1.0
