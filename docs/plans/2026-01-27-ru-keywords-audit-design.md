# Дизайн: Аудит неиспользуемых RU ключей

**Дата:** 2026-01-27
**Задача:** Найти ключи из `ull_all_rus_keys.csv`, которые не задействованы в категориях, и дать рекомендации по распределению.

---

## Входные данные

| Файл | Описание |
|------|----------|
| `ull_all_rus_keys.csv` | Все RU ключи с частотностью (формат: Фраза, кол-во, GA) |
| `categories/**/*_clean.json` | Семантика категорий (keywords + synonyms) |

## Выходные данные

**Файл:** `reports/2026-01-27-unused-ru-keywords.md`

**Формат отчёта:**
```markdown
# Неиспользуемые RU ключи

## Сводка
- Всего ключей в CSV: X
- Используется в категориях: Y
- Не используется: Z

## Ключи для главной страницы (glavnaya)
| Ключ | Частотность |
|------|-------------|
| автокосметика | 480 |
| автохимия | 470 |
| ... | ... |

## Ключи для существующих категорий
| Ключ | Частотность | Рекомендуемая категория |
|------|-------------|------------------------|
| ... | ... | ... |

## Ключи без очевидной категории
| Ключ | Частотность | Комментарий |
|------|-------------|-------------|
| ... | ... | ... |
```

---

## Алгоритм

### Шаг 1: Сбор ключей из CSV
- Парсим `ull_all_rus_keys.csv`
- Игнорируем строки-заголовки (L1:, L2:, L3:, SEO-Фильтр:)
- Игнорируем пустые строки и строки без частотности
- Нормализуем: lowercase, trim

### Шаг 2: Сбор используемых ключей
- Читаем все `categories/**/*_clean.json`
- Извлекаем `keywords[].keyword` и `synonyms[].keyword`
- Нормализуем: lowercase

### Шаг 3: Поиск неиспользуемых
- `unused = csv_keys - used_keys`

### Шаг 4: Классификация неиспользуемых
Правила определения категории:

| Паттерн в ключе | Рекомендуемая категория |
|-----------------|------------------------|
| `^автохимия$`, `^автокосметика$`, `интернет магазин`, `киев`, `украина`, `купить автохимию`, `детейлинг магазин` | **glavnaya** (новая) |
| `пена`, `бесконтакт` | aktivnaya-pena |
| `шампунь`, `ручн` мойк` | shampuni-dlya-ruchnoy-moyki |
| `омыват`, `стеклоомыват` | omyvatel |
| `антидожд`, `гидрофоб` стекл` | antidozhd |
| `очист` стекл`, `стекло` | ochistiteli-stekol |
| `полироль` стекл` | polirol-dlya-stekla |
| `двигател`, `мотор` | ochistiteli-dvigatelya |
| `обезжир` | obezzhirivateli |
| `антибитум`, `битум`, `смол` | antibitum |
| `мошк`, `насеком` | antimoshka |
| `глин`, `скраб` | glina-i-avtoskraby |
| `пластик` нар`, `бампер`, `молдинг` | ukhod-za-naruzhnym-plastikom |
| `диск`, `колес` очист` | ochistiteli-diskov |
| `черн` шин`, `черн` рез`, `блеск` шин` | cherniteli-shin |
| `очист` шин` | ochistiteli-shin |
| `керамик` диск` | keramika-dlya-diskov |
| `химчист`, `салон` чист`, `ткан` | sredstva-dlya-khimchistki-salona |
| `пятн`, `выводит` | pyatnovyvoditeli |
| `запах`, `нейтрализ`, `поглотит` | neytralizatory-zapakha |
| `пластик` салон`, `торпед`, `полироль` пластик` | poliroli-dlya-plastika |
| `кож` очист`, `кож` чист` | ochistiteli-kozhi |
| `кож` уход`, `кож` крем`, `кондиц` кож` | ukhod-za-kozhey |
| `воск` тверд` | tverdyy-vosk |
| `воск` жидк` | zhidkiy-vosk |
| `воск` | voski |
| `силант`, `герметик` | silanty |
| `керамик`, `жидк` стекл`, `нанокерамик` | keramika-i-zhidkoe-steklo |
| `квик`, `детейлер`, `спрей` воск` | kvik-deteylery |
| `полиров` паст`, `абразив` паст` | polirovalnye-pasty |
| `полиров` машин`, `полировщик` | polirovalnye-mashinki (или akkumulyatornaya) |
| `круг` полир`, `мехов` | mekhovye |
| `микрофибр`, `тряпк`, `салфетк` | mikrofibra-i-tryapki |
| `губк`, `варежк`, `мочалк` | gubki-i-varezhki |
| `кист`, `щетк` детейл` | kisti-dlya-deteylinga |
| `щетк` мойк` | shchetka-dlya-moyki-avto |
| `распылит`, `триггер`, `пенник` | raspyliteli-i-penniki |
| `ведр`, `ёмкост` | vedra-i-emkosti |
| `скотч`, `маляр` | malyarniy-skotch |
| `набор` | nabory |
| `торнадор` | apparaty-tornador |
| `опт`, `b2b`, `производител` | opt-i-b2b |

### Шаг 5: Генерация отчёта
- Группируем по рекомендуемой категории
- Сортируем внутри группы по частотности (desc)
- Формируем markdown

---

## Ограничения

- Один ключ — одна рекомендация (первое совпадение по паттернам)
- Ключи с частотностью 0 включаем, но помечаем
- Не модифицируем `_clean.json` файлы — только отчёт

---

## Критерии успеха

1. Отчёт содержит все неиспользуемые ключи
2. Каждый ключ имеет рекомендацию (категория или "без категории")
3. Ключи для glavnaya выделены отдельно
4. Отчёт сохранён в `reports/`
