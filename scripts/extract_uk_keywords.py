#!/usr/bin/env python3
"""
Извлекает все ключевые слова из _clean.json файлов и переводит на украинский.
Выводит уникальные ключи, каждый на новой строке.
"""

import json
import re
from pathlib import Path

# Словарь перевода RU → UK
TRANSLATION_DICT = {
    # Автохимия (базовые термины)
    "резина": "гума",
    "резины": "гуми",
    "резину": "гуму",
    "резиной": "гумою",
    "средство": "засіб",
    "средства": "засоби",
    "средств": "засобів",
    "автомобиль": "автомобіль",
    "автомобиля": "автомобіля",
    "автомобилей": "автомобілів",
    # Чернители/уход за резиной
    "чернитель": "чорнитель",
    "чернителя": "чорнителя",
    "чернителем": "чорнителем",
    "чернители": "чорнителі",
    "чернителей": "чорнителів",
    "чернение": "чорніння",
    "блеск": "блиск",
    "блеска": "блиску",
    # Мойка
    "мойка": "миття",
    "мойки": "миття",
    "мойку": "миття",
    "мойкой": "миттям",
    "мыть": "мити",
    "бесконтактная": "безконтактне",
    "бесконтактной": "безконтактного",
    "ручная": "ручне",
    "ручной": "ручного",
    "активная": "активна",
    "активной": "активної",
    "пена": "піна",
    "пены": "піни",
    "пену": "піну",
    "пеной": "піною",
    "минимойка": "мінімийка",
    "минимойки": "мінімийки",
    "минимойку": "мінімийку",
    # Стекла/оптика
    "стекло": "скло",
    "стекла": "скла",
    "стеклу": "склу",
    "стеклом": "склом",
    "стекол": "скла",
    "антидождь": "антидощ",
    "антидождя": "антидощу",
    # Очистители
    "очиститель": "очищувач",
    "очистителя": "очищувача",
    "очистителем": "очищувачем",
    "очистители": "очищувачі",
    "очистителей": "очищувачів",
    "обезжириватель": "знежирювач",
    "обезжиривателя": "знежирювача",
    "обезжиривателем": "знежирювачем",
    "обезжириватели": "знежирювачі",
    "обезжиривателей": "знежирювачів",
    "антибитум": "антибітум",
    "антибитума": "антибітуму",
    # Глина/скрабы
    "деконтаминация": "деконтамінація",
    "деконтаминации": "деконтамінації",
    # Защита
    "воск": "віск",
    "воска": "воску",
    "воском": "воском",
    "полироль": "поліроль",
    "полироли": "поліролі",
    "полиролью": "поліроллю",
    "керамика": "кераміка",
    "керамики": "кераміки",
    "керамику": "кераміку",
    "керамикой": "керамікою",
    "защитное": "захисне",
    "защитного": "захисного",
    "защитная": "захисна",
    "защитной": "захисної",
    "покрытие": "покриття",
    "покрытия": "покриття",
    "покрытием": "покриттям",
    # Коммерческие
    "купить": "купити",
    "цена": "ціна",
    "цены": "ціни",
    "цену": "ціну",
    "заказать": "замовити",
    # Дополнительные термины
    "диск": "диск",
    "диска": "диска",
    "дисков": "дисків",
    "дискам": "дискам",
    "дисками": "дисками",
    "шина": "шина",
    "шины": "шини",
    "шин": "шин",
    "шинами": "шинами",
    "двигатель": "двигун",
    "двигателя": "двигуна",
    "кожа": "шкіра",
    "кожи": "шкіри",
    "кожу": "шкіру",
    "кожей": "шкірою",
    "кожаный": "шкіряний",
    "кожаная": "шкіряна",
    "кожаного": "шкіряного",
    "кожаной": "шкіряної",
    "салон": "салон",
    "салона": "салону",
    "салоном": "салоном",
    "интерьер": "інтер'єр",
    "интерьера": "інтер'єру",
    "пластик": "пластик",
    "пластика": "пластику",
    "пластиком": "пластиком",
    "наружный": "зовнішній",
    "наружного": "зовнішнього",
    "наружным": "зовнішнім",
    "химчистка": "хімчистка",
    "химчистки": "хімчистки",
    "химчисткой": "хімчисткою",
    "пятновыводитель": "плямовивідник",
    "пятновыводителя": "плямовивідника",
    "пятновыводители": "плямовивідники",
    "пятновыводителей": "плямовивідників",
    "нейтрализатор": "нейтралізатор",
    "нейтрализатора": "нейтралізатора",
    "нейтрализаторы": "нейтралізатори",
    "нейтрализаторов": "нейтралізаторів",
    "запах": "запах",
    "запаха": "запаху",
    "запахов": "запахів",
    "микрофибра": "мікрофібра",
    "микрофибры": "мікрофібри",
    "микрофибру": "мікрофібру",
    "микрофиброй": "мікрофіброю",
    "тряпка": "ганчірка",
    "тряпки": "ганчірки",
    "тряпок": "ганчірок",
    "губка": "губка",
    "губки": "губки",
    "губок": "губок",
    "губкой": "губкою",
    "варежка": "рукавиця",
    "варежки": "рукавиці",
    "варежкой": "рукавицею",
    "щетка": "щітка",
    "щетки": "щітки",
    "щеток": "щіток",
    "щеткой": "щіткою",
    "кисть": "пензель",
    "кисти": "пензлі",
    "кистей": "пензлів",
    "кистью": "пензлем",
    "ведро": "відро",
    "ведра": "відра",
    "ведер": "відер",
    "ведром": "відром",
    "емкость": "ємність",
    "емкости": "ємності",
    "емкостей": "ємностей",
    "распылитель": "розпилювач",
    "распылителя": "розпилювача",
    "распылители": "розпилювачі",
    "распылителей": "розпилювачів",
    "пенник": "піногенератор",
    "пенника": "піногенератора",
    "пенники": "піногенератори",
    "набор": "набір",
    "набора": "набору",
    "наборы": "набори",
    "наборов": "наборів",
    "оборудование": "обладнання",
    "оборудования": "обладнання",
    "оборудованием": "обладнанням",
    "полировка": "полірування",
    "полировки": "полірування",
    "полировкой": "поліруванням",
    "полировальный": "полірувальний",
    "полировальная": "полірувальна",
    "полировальные": "полірувальні",
    "полировальных": "полірувальних",
    "машинка": "машинка",
    "машинки": "машинки",
    "машинок": "машинок",
    "круг": "круг",
    "круга": "круга",
    "круги": "круги",
    "кругов": "кругів",
    "паста": "паста",
    "пасты": "пасти",
    "паст": "паст",
    "пастой": "пастою",
    "меховой": "хутряний",
    "меховая": "хутряна",
    "меховые": "хутряні",
    "меховых": "хутряних",
    "аккумуляторный": "акумуляторний",
    "аккумуляторная": "акумуляторна",
    "аккумуляторные": "акумуляторні",
    "торнадор": "торнадор",
    "торнадора": "торнадора",
    "силант": "силант",
    "силанта": "силанту",
    "силанты": "силанти",
    "силантов": "силантів",
    "детейлинг": "детейлінг",
    "детейлинга": "детейлінгу",
    "детейлером": "детейлером",
    "омыватель": "омивач",
    "омывателя": "омивача",
    "омывателей": "омивачів",
    "жидкий": "рідкий",
    "жидкая": "рідка",
    "жидкого": "рідкого",
    "жидкое": "рідке",
    "твердый": "твердий",
    "твердая": "тверда",
    "твердого": "твердого",
    "скотч": "скотч",
    "скотча": "скотчу",
    "малярный": "малярний",
    "малярного": "малярного",
    "квик-детейлер": "квік-детейлер",
    "квик-детейлера": "квік-детейлера",
    "квик-детейлеры": "квік-детейлери",
    "квик-детейлеров": "квік-детейлерів",
    "уход": "догляд",
    "ухода": "догляду",
    "уходом": "доглядом",
}


def translate_keyword(keyword: str) -> str:
    """Переводит ключевое слово на украинский."""
    result = keyword.lower()

    # Сортируем по длине (длинные фразы сначала) чтобы избежать частичных замен
    sorted_dict = sorted(TRANSLATION_DICT.items(), key=lambda x: len(x[0]), reverse=True)

    for ru, uk in sorted_dict:
        # Используем word boundary для точного совпадения
        pattern = r"\b" + re.escape(ru) + r"\b"
        result = re.sub(pattern, uk, result, flags=re.IGNORECASE)

    return result


def extract_keywords_from_file(filepath: Path) -> set:
    """Извлекает все ключи из _clean.json файла."""
    keywords = set()

    try:
        with open(filepath, "r", encoding="utf-8") as f:
            data = json.load(f)
    except (json.JSONDecodeError, FileNotFoundError) as e:
        print(f"Ошибка чтения {filepath}: {e}")
        return keywords

    # Извлекаем keywords
    for item in data.get("keywords", []):
        if "keyword" in item:
            keywords.add(item["keyword"].lower().strip())

    # Извлекаем synonyms
    for item in data.get("synonyms", []):
        if "keyword" in item:
            keywords.add(item["keyword"].lower().strip())

    # Извлекаем variations
    for item in data.get("variations", []):
        if "keyword" in item:
            keywords.add(item["keyword"].lower().strip())

    return keywords


def main():
    categories_dir = Path(__file__).parent.parent / "categories"

    # Собираем все _clean.json файлы
    clean_files = list(categories_dir.glob("**/*_clean.json"))
    print(f"Найдено {len(clean_files)} файлов _clean.json")

    # Извлекаем все ключи
    all_ru_keywords = set()
    for filepath in clean_files:
        keywords = extract_keywords_from_file(filepath)
        all_ru_keywords.update(keywords)

    print(f"Извлечено {len(all_ru_keywords)} уникальных русских ключей")

    # Переводим на украинский
    all_uk_keywords = set()
    for ru_kw in all_ru_keywords:
        uk_kw = translate_keyword(ru_kw)
        all_uk_keywords.add(uk_kw)

    print(f"После перевода: {len(all_uk_keywords)} уникальных украинских ключей")

    # Сортируем
    sorted_keywords = sorted(all_uk_keywords)

    # Записываем в файл
    output_path = Path(__file__).parent.parent / "data" / "generated" / "UK_KEYWORDS_FOR_FREQUENCY.md"
    output_path.parent.mkdir(parents=True, exist_ok=True)

    with open(output_path, "w", encoding="utf-8") as f:
        for kw in sorted_keywords:
            f.write(kw + "\n")

    print(f"\nФайл сохранён: {output_path}")
    print(f"Всего ключей: {len(sorted_keywords)}")


if __name__ == "__main__":
    main()
